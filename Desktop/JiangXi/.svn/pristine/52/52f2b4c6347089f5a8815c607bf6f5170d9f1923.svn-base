//
//  ResourceMainVC.m
//  JiangXiResource
//
//  Created by 信辉科技 on 16/8/29.
//  Copyright © 2016年 sinceretech. All rights reserved.
//

#import "ResourceMainVC.h"
#import "ResourceModel.h"
#import "ResourceSearchModel.h"
#import "MoreView.h"
#import "UIColor+Ext.h"
#import "CustomSegView.h"
#import "DetailView.h"
#import "ResourceHistoryVC.h"
#import "StandardAddressVC.h"
#import "SearchResourcesViewController.h"
// 边距
#define kPadding 5
// 边框颜色
#define kBorderColor [UIColor colorWithRed:0.00f green:0.51f blue:0.82f alpha:1.00f]
// 按钮颜色
#define kBtnSelectedColor UIColorFromHex(0x0185ce)

@interface ResourceMainVC ()
<
MoreViewDelegate,
UITextFieldDelegate,
CustomSegViewDelegate,
DetailDelegate,
UIActionSheetDelegate
>
// UI部分
@property (nonatomic, strong) UITextField *searchTf;                // 宽带账号
@property (nonatomic, strong) MoreView *moreView;                   // 更多View
@property (nonatomic, strong) UIView *topView;                      // 搜索框和搜索按钮(头视图)
@property (nonatomic, strong) CustomSegView *segView;               // 按钮视图(尾视图)
@property (nonatomic, strong) DetailView *detailView;               // 详细信息View
// 数据部分
@property (nonatomic, strong) ResourceModel *model;                 // 输出部分
@property (nonatomic, strong) NSArray *actTitles;                   // 用于actionSheet显示的信息

@end

@implementation ResourceMainVC

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    self.title = @"资源更改";
    
    [self dataConfig];
    
    [self uiConfig];
    
    self.detailView.model = self.model;
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

#pragma mark -----------辅助方法-----------
// 返回
- (void)backAction:(UIButton *)btn
{
    NSLog(@"%s", __func__);
}
// 显示历史记录
- (void)showMore:(UIButton *)btn
{
    self.moreView.isShow = !self.moreView.isShow;
}

// 根据宽带账号搜索
- (void)searchAction:(UIButton *)btn
{
    
}

#pragma mark -----------代理-----------
#pragma mark MoreViewDelegate
- (void)clickItem:(NSInteger)index
{
    ResourceHistoryVC *history = [[ResourceHistoryVC alloc] init];
    [self.navigationController pushViewController:history animated:YES];
}

#pragma mark UITextField Delegate
- (BOOL)textFieldShouldReturn:(UITextField *)textField
{
    [textField resignFirstResponder];
    return YES;
}

#pragma mark CustomSegView Delegate
- (void)clickSegItem:(NSInteger)index
{
    NSLog(@"%ld", index);
    if (index == 0) {
        self.model.addressName = @"的垃圾分类卡时间的离开房间爱离开市领导及法律";
    } else {
        self.model.portName = @"的垃圾分类卡时间的离开房间爱离开市领导及法律";
    }
    
    self.detailView.model = self.model;
}

#pragma mark Detail Delegate
- (void)detailInfo:(clickType)type
{
    if (type == clickTypeNewAddress) {
        NSLog(@"新地址");
        StandardAddressVC *vc = [[StandardAddressVC alloc] init];
        [self.navigationController pushViewController:vc animated:YES];
    } else if (type == clickTypeNewPort) {
        NSLog(@"新端口");
        SearchResourcesViewController *vc = [[SearchResourcesViewController alloc] init];
        [vc setSearchResourcesViewCallBack:^(NSDictionary *dataDic) {
            NSLog(@"%@",[dataDic valueForKey:@"name"]);
        }];
        [self.navigationController pushViewController:vc animated:YES];
    } else if (type == clickTypeNewReason) {
        NSLog(@"更改原因");
        UIActionSheet *act = [[UIActionSheet alloc] initWithTitle:nil delegate:self cancelButtonTitle:@"取消" destructiveButtonTitle:nil otherButtonTitles:@"装机地址错误", @"装机地址错误", @"端口损坏", nil];
        [act showInView:self.view];
    }
}

#pragma mark UIActionSheet Delegate
- (void)actionSheet:(UIActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex
{
    if (buttonIndex != self.actTitles.count) {
        self.model.changeReason = self.actTitles[buttonIndex];
        self.detailView.model = self.model;
    }
}

#pragma mark -----------数据初始化-----------
- (void)dataConfig
{
    self.model = [[ResourceModel alloc] init];
    self.model.accountName = @"13912345678";
    self.model.userName = @"张三";
    self.model.way = @"FITH";
    self.model.workOrderNum = @"JKGD-20160823-001,南昌市新区万达华府1单元301室";
    self.model.orderNum = @"JKGD-20160823-001,JKGD-20160823-001,JKGD-20160823-001,JKGD-20160823-001,JKGD-20160823-001,";
    self.model.orderStatus = @"归档";
    self.model.activeStatus = @"激活成功!";
    self.model.originAddressName = @"南昌市新区万达华府1单元301室";
    self.model.originPortName = @"南昌市新区万达华府1单元12#分纤箱-1-1-1";
    self.model.changeReason = @"端子损坏";
    
}

- (NSArray *)actTitles
{
    if (_actTitles == nil) {
        _actTitles = @[@"装机地址错误", @"装机地址错误", @"端口损坏"];
    }
    return _actTitles;
}

#pragma mark -----------UI-----------
- (void)uiConfig
{
    // 右侧导航栏添加更多按钮
    [self navigateConfig];
    
    /* 
     * 分上中下三部分，
     * 上半部分搜索框，中间TableView，下半部分两个按钮
     */
    [self configTop];
    
    [self configBottom];
    
    [self configMiddle];
    
}

- (void)navigateConfig
{
    // 左侧返回
    UIButton *backBtn = ({
        UIButton *btn = [UIButton new];
        btn.frame = CGRectMake(0, 0, 40, 40);
        [btn setImage:[UIImage imageNamed:@"wallet_base_action_bar_back_normal"] forState:UIControlStateNormal];
        [btn addTarget:self action:@selector(backAction:) forControlEvents:UIControlEventTouchUpInside];
        btn;
    });
    self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:backBtn];
    
    // 右侧更多
    UIButton *button = ({
        UIButton *btn = [UIButton new];
        btn.frame = CGRectMake(0, 0, 30, 30);
        [btn setImage:[UIImage imageNamed:@"track_icon_more"] forState:UIControlStateNormal];
        [btn addTarget:self action:@selector(showMore:) forControlEvents:UIControlEventTouchUpInside];
        btn;
    });
    self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:button];
}

- (void)configTop
{
    self.topView = ({
        UIView *view = [UIView new];
        view.layer.borderColor = kBorderColor.CGColor;
        view.layer.borderWidth = 1;
        
        
        [self.view addSubview:view];
        
        [view mas_makeConstraints:^(MASConstraintMaker *make) {
            make.top.left.right.equalTo(self.view).insets(UIEdgeInsetsMake(kPadding, kPadding, 0, kPadding));
            make.height.mas_equalTo(44);
        }];
        
        view;
    });
    
    self.searchTf = ({
        UITextField *tf = [UITextField new];
        tf.placeholder = @"请输入宽带账号";
        tf.layer.borderColor = kBorderColor.CGColor;
        tf.layer.borderWidth = 1;
        tf.borderStyle = UITextBorderStyleNone;
        tf.clearButtonMode = UITextFieldViewModeAlways;
        tf.delegate = self;
        [self.topView addSubview:tf];
        
        tf;
    });
    
    UIButton *searchBtn = ({
        UIButton *btn = [UIButton new];
        [btn setImage:[UIImage imageNamed:@"search"] forState:UIControlStateNormal];
        [btn addTarget:self action:@selector(searchAction:) forControlEvents:UIControlEventTouchUpInside];
        [self.topView addSubview:btn];
        
        btn;
    });
    
    [self.searchTf mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.top.bottom.equalTo(self.topView).insets(UIEdgeInsetsZero);
        make.right.equalTo(searchBtn.mas_left);
    }];
    
    [searchBtn mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.bottom.right.equalTo(self.topView).insets(UIEdgeInsetsZero);
        make.width.mas_equalTo(40);
    }];
}

- (void)configMiddle
{
    self.detailView = ({
        DetailView *view = [DetailView new];
        view.delegate = self;
        view.layer.borderColor = [UIColor lightGrayColor].CGColor;
        view.layer.borderWidth = 1;
        [self.view addSubview:view];
        
        [view mas_makeConstraints:^(MASConstraintMaker *make) {
            make.top.equalTo(self.topView.mas_bottom).offset(kPadding);
            make.left.right.equalTo(self.view).insets(UIEdgeInsetsMake(0, kPadding, 0, kPadding));
            make.bottom.equalTo(self.segView.mas_top).offset(-kPadding);
        }];
        
        view;
    });
}

- (void)configBottom
{
    self.segView = ({
        CustomSegView *seg = [CustomSegView new];
        [self.view addSubview:seg];
        
        [seg mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.right.bottom.equalTo(self.view).insets(UIEdgeInsetsMake(0, kPadding, kPadding, kPadding));
            make.height.mas_equalTo(40);
        }];
        
        seg.isDifferent = NO;
        seg.titleArray = @[@"提交",
                           @"刷新"];
        seg.delegate = self;
        
        seg;
    });
}

- (MoreView *)moreView
{
    if (_moreView == nil) {
        _moreView = ({
            MoreView *view = [MoreView new];
            
            // 定义显示内容
            NSArray *titleArray = @[@"历史记录"];
            
            UIWindow *window = [[[UIApplication sharedApplication]delegate]window];
            [window addSubview:view];
            
            // 布局
            [view mas_makeConstraints:^(MASConstraintMaker *make) {
                make.edges.equalTo(window).insets(UIEdgeInsetsZero);
            }];
            
            view.titleArray = titleArray;
            view.delegate = self;
            
            view;
        });
    }
    return _moreView;
}


@end
